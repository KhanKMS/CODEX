-- Azure Container Registry 서비스 > 이미지 저장 --

ACR_NAME=acrkmsreg
ACR_RES_GROUP=$ACR_NAME

az group create --resource-group $ACR_RES_GROUP --location koreacentral
az acr create --resource-group $ACR_RES_GROUP --name $ACR_NAME --sku Standard --location koreacentral

LOGIN SERVER : acrkmsreg.azurecr.io

---- Azure Kubernetes Service 클러스터 작성 

ACR_ID=$(az acr show --name $ACR_NAME --query id --output tsv)

SP_NAME=sample-acr-service-principal

SP_PASSWD=$(az ad sp create-for-rbac --name $SP_NAME --role Reader --scopes $ACR_ID --query password --output tsv)

APP_ID=$(az ad sp show --id (000000-0000-0000-0000-0000000) --query appId)
#Azure AD 관리자 화면에서 App ID 확인 가능

AKS_CLUSTER_NAME=AKSCluster 
AKS_RES_GROUP=$AKS_CLUSTER_NAME

az aks create \
--name $AKS_CLUSTER_NAME \
--resource-group $AKS_RES_GROUP \
--node-count 3 \
--kubernetes-version 1.22.11 \
--node-vm-size Standard_A2_v2 \
--generate-ssh-keys \
--service-principal $APP_ID \
--client-secret $SP_PASSWD

az aks get-credentials --admin --resource-group $AKS_RES_GROUP --name $AKS_CLUSTER_NAME
